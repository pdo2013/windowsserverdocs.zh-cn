---
ms.assetid: d1953097-63ea-4a0e-b860-2f3b7c175c41
title: Windows 时间服务的工作原理
description: ''
author: shortpatti
ms.author: pashort
manager: dougkim
ms.date: 05/08/2018
ms.topic: article
ms.prod: windows-server
ms.technology: networking
ms.openlocfilehash: 2bf4a887218cd51e9c10954a75bbc1ba2112647f
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/27/2019
ms.locfileid: "71405144"
---
# <a name="how-the-windows-time-service-works"></a>Windows 时间服务的工作原理

>适用于：Windows Server 2016，Windows Server 2012 R2，Windows Server 2012，Windows 10 或更高版本

**本部分内容**  
  
-   [Windows 时间服务体系结构](#windows-time-service-architecture)  
  
-   [Windows 时间服务时间协议](#windows-time-service-time-protocols)  
  
-   [Windows 时间服务进程和交互](#windows-time-service-processes-and-interactions)  
  
-   [Windows 时间服务使用的网络端口](#network-ports-used-by-windows-time-service)  
  
> [!NOTE]  
> 本主题仅介绍 Windows 时间服务（W32Time）的工作方式。 有关如何配置 Windows 时间服务的信息，请参阅[配置系统以获得高准确性](configuring-systems-for-high-accuracy.md)。
  
> [!NOTE]  
> 在 Windows Server 2003 和 Microsoft Windows 2000 服务器中，目录服务被命名为 Active Directory directory 服务。 在 Windows Server 2008 及更高版本中，目录服务被命名为 Active Directory 域服务（AD DS）。 本主题的其余部分引用了 AD DS，但该信息还适用于 Active Directory。  
  
尽管 Windows 时间服务不是网络时间协议（NTP）的确切实现，但它使用 NTP 规范中定义的复杂算法套件来确保网络中计算机上的时钟尽可能准确。 理想情况下，AD DS 域中的所有计算机时钟都将与权威计算机的时间同步。 许多因素可能会影响网络上的时间同步。 以下因素通常会影响 AD DS 中同步的准确性：  
  
-   网络条件  
  
-   计算机硬件时钟的准确性  
  
-   适用于 Windows 时间服务的 CPU 和网络资源的数量  
  
> [!IMPORTANT]  
> 在 Windows Server 2016 之前，W32Time 服务并未设计为满足区分时间的应用程序需要。  但是，Windows Server 2016 的更新现在允许你在域中实施1ms 准确性解决方案。  有关详细信息，请参阅[windows 2016 准确时间](accurate-time.md)和[支持边界，为高准确性环境配置 windows 时间服务](support-boundary.md)。  
  
默认情况下，将不经常同步时间或未加入域的计算机配置为与 time.windows.com 同步。  因此，无法保证计算机上的时间准确性，甚至无网络连接。  
  
AD DS 林具有预先确定的时间同步层次结构。 Windows 时间服务在层次结构中的计算机之间同步时间，最精确的引用时钟在顶部。 如果在一台计算机上配置了多个时间源，则 Windows 时间会根据计算机与该时间源的同步能力，使用 NTP 算法从配置的源中选择最佳的时间源。 Windows 时间服务不支持来自广播或多播对等方的网络同步。 有关这些 NTP 功能的详细信息，请参阅 IETF RFC 数据库中的 RFC 1305。  
  
运行 Windows 时间服务的每台计算机都使用该服务来维护最准确的时间。 默认情况下，作为域成员的计算机充当时间客户端，因此，在大多数情况下，不需要配置 Windows 时间服务。 但是，可以将 Windows 时间服务配置为从指定的引用时间源请求时间，还可以为客户端提供时间。
  
计算机时间精确到的程度称为 "层次"。 网络上最准确的时间源（如硬件时钟）占用最低层次等级或层次一级。 此准确的时间源称为 "引用时钟"。 直接从引用时钟获取其时间的 NTP 服务器占用的层次比引用时钟的级别高一级。 从 NTP 服务器获取时间的资源是离开引用时钟的两个步骤，因此占用的层次比最准确的时间源大两个，依此类推。 随着计算机的层次号码的增加，其系统时钟的时间可能会变得不太准确。 因此，任何计算机的层次级别都表明了计算机与最准确的时间源的同步程度。  
  
当 W32Time 管理器收到时间示例时，它将使用 NTP 中的特殊算法来确定哪些时间样本最适合使用。 时间服务还会使用另一组算法来确定哪些配置的时间源最准确。 当时间服务根据以上标准确定了哪个时间示例是最佳的，它会调整本地时钟速率，使其能够汇聚到正确的时间。 如果通过调整本地时钟速率，本地时钟和所选的准确时间样本（也称为 "时间偏差"）之间的时间差太大而无法更正，则时间服务会将本地时钟设置为正确的时间。 此时钟速率调整或直接时钟时间更改称为 "时钟规则"。  
  
## <a name="windows-time-service-architecture"></a>Windows 时间服务体系结构  
Windows 时间服务包含以下组件：  
  
-   服务控制管理器  
  
-   Windows 时间 Service Manager  
  
-   时钟规范  
  
-   时间提供程序  
  
下图显示了 Windows 时间服务的体系结构。  
  
**Windows 时间服务体系结构**  
  
![Windows 时间](../media/Windows-Time-Service/How-the-Windows-Time-Service-Works/trnt_sec_arcc.gif)
  
服务控制管理器负责启动和停止 Windows 时间服务。 Windows 时间 Service Manager 负责启动操作系统随附的 NTP 时间提供程序的操作。 Windows 时间 Service Manager 控制 Windows 时间服务的所有功能和所有时间示例的合并。 除了提供当前系统状态的信息（例如当前时间源或上次更新系统时钟的时间），Windows 时间 Service Manager 还负责在事件日志中创建事件。  
  
时间同步过程包括以下步骤：  
  
-   输入提供程序从配置的 NTP 时间源请求和接收时间示例。  
  
-   然后，将这些时间示例传递到 Windows 时间 Service Manager，这将收集所有示例并将其传递给时钟学科子组件。  
  
-   时钟学科子组件应用 NTP 算法，这会导致选择最佳的时间示例。  
  
-   通过调整时钟速率或直接更改时间，时钟学科子组件可以将系统时钟的时间调整到最准确的时间。  
  
如果计算机已指定为时间服务器，则可以在此过程中的任何时间点将时间发送到任何请求时间同步的计算机。  
  
## <a name="windows-time-service-time-protocols"></a>Windows 时间服务时间协议  

时间协议确定同步两台计算机时钟的方式。 时间协议负责确定最佳可用时间信息，并聚合时钟，以确保在不同的系统上保持一致的时间。  
  
Windows 时间服务使用网络时间协议（NTP）来帮助同步网络上的时间。 NTP 是一种 Internet 时间协议，其中包括同步时钟所需的专业算法。 NTP 是比在某些版本的 Windows 中使用的简单网络时间协议（SNTP）更准确的时间协议;但是，W32Time 继续支持 SNTP，以便能够与运行基于 SNTP 的时间服务（例如 Windows 2000）的计算机向后兼容。  
  
### <a name="network-time-protocol"></a>网络时间协议  
网络时间协议（NTP）是操作系统中 Windows 时间服务使用的默认时间同步协议。 NTP 是一种容错、高度可缩放的时间协议，是最常使用指定时间引用来同步计算机时钟的协议。  
  
NTP 时间同步发生在一段时间内，并涉及通过网络传输 NTP 数据包。 NTP 数据包包含时间戳，其中包含来自客户端和参与时间同步的服务器的时间示例。  
  
NTP 依赖引用时钟定义要使用的最准确时间，并使网络上的所有时钟与该引用时钟同步。 NTP 使用协调世界时（UTC）作为当前时间的通用标准。 UTC 独立于时区，并允许在世界任何地方使用 NTP，而不考虑时区设置。  
  
#### <a name="ntp-algorithms"></a>NTP 算法  
NTP 包括两种算法，即时钟筛选算法和时钟选择算法，用于帮助 Windows 时间服务确定最佳时间示例。 时钟筛选算法旨在用于筛选从查询时间源接收的时间样本，并从每个源确定最佳时间样本。 然后，时钟选择算法会确定网络上最准确的时间服务器。 然后，将此信息传递给时钟学科算法，该算法使用收集的信息来更正计算机的本地时钟，同时补偿因网络延迟和计算机时钟导致导致的错误。  
  
在光速到适中的网络和服务器负载条件下，NTP 算法最为准确。 与考虑网络传输时间的任何算法一样，NTP 算法在极端网络拥塞的情况下可能会表现不佳。 有关 NTP 算法的详细信息，请参阅 IETF RFC 数据库中的 RFC 1305。  
  
#### <a name="ntp-time-provider"></a>NTP 时间提供程序  
Windows 时间服务是一个完整的时间同步包，它可以支持各种硬件设备和时间协议。 若要启用此支持，服务将使用可插入时间提供程序。 时间提供程序负责获取准确的时间戳（来自网络或硬件），或通过网络将这些时间戳提供给其他计算机。  
  
NTP 提供程序是操作系统随附的标准时间提供程序。 NTP 提供程序按照 NTP 版本3为客户端和服务器指定的标准，可与 SNTP 客户端和服务器进行交互，以便与 Windows 2000 和其他 SNTP 客户端向后兼容。 Windows 时间服务中的 NTP 提供程序由以下两个部分组成：  
  
-   **NtpServer 输出提供程序。** 这是对网络上的客户端时间请求作出响应的时间服务器。  
  
-   **NtpClient 输入提供程序。** 这是一个时间客户端，它从另一个源（硬件设备或 NTP 服务器）获取时间信息，并且可以返回对同步本地时钟非常有用的时间示例。  
  
虽然这两个提供程序的实际操作密切相关，但它们与时间服务无关。 从 Windows 2000 Server 开始，当 Windows 计算机连接到网络时，它将被配置为 NTP 客户端。 而且，运行 Windows 时间服务的计算机仅尝试使用域控制器或手动指定的时间源同步时间。 这些是首选的时间提供程序，因为它们自动可用，并保护时间源。  
  
#### <a name="ntp-security"></a>NTP 安全性  

在 AD DS 林中，Windows 时间服务依赖于标准域安全功能来强制对时间数据进行身份验证。 域成员计算机和充当时间服务器的本地域控制器之间发送的 NTP 数据包的安全性基于共享密钥身份验证。 Windows 时间服务使用计算机的 Kerberos 会话密钥，在通过网络发送的 NTP 包上创建经过身份验证的签名。 NTP 数据包不在 Net Logon 安全通道内传输。 相反，当计算机请求域层次结构中的域控制器的时间时，Windows 时间服务要求对时间进行身份验证。 然后，域控制器以64位值的形式返回所需的信息，该值已使用 Net Logon 服务中的会话密钥进行身份验证。 如果返回的 NTP 数据包未用计算机的会话密钥进行签名，或者未正确签名，则会拒绝该时间。 所有此类身份验证失败都记录在事件日志中。 通过这种方式，Windows 时间服务为 AD DS 林中的 NTP 数据提供安全性。  
  
通常，Windows 时间客户端会自动从同一个域中的域控制器获得同步的准确时间。 在林中，子域的域控制器与父域中的域控制器同步时间。 当时间服务器将经过身份验证的 NTP 数据包返回到请求时间的客户端时，会通过域间信任帐户定义的 Kerberos 会话密钥对数据包进行签名。 域间信任帐户是在新的 AD DS 域加入林时创建的，Net Logon 服务管理会话密钥。 通过这种方式，在目录林根级域中配置为可靠的域控制器将成为父域和子域中所有域控制器的经过身份验证的时间源，并间接用于域树中的所有计算机。  
  
Windows 时间服务可以配置为在林之间工作，但请务必注意，此配置不安全。 例如，可以在不同的林中使用 NTP 服务器。 但是，因为该计算机在不同的林中，所以没有用于对 NTP 数据包进行签名和身份验证的 Kerberos 会话密钥。 若要从不同林中的计算机获取准确的时间同步，客户端需要对该计算机的网络访问权限，并且必须将时间服务配置为使用位于其他林中的特定时间源。 如果手动将客户端配置为从其自己的域层次结构之外的 NTP 服务器访问时间，则不会对客户端和时间服务器之间发送的 NTP 数据包进行身份验证，因此不安全。 即使实施了林信任，Windows 时间服务也不会在林之间安全。 尽管 Net Logon 安全通道是适用于 Windows 时间服务的身份验证机制，但不支持跨林进行身份验证。  
  
#### <a name="hardware-devices-that-are-supported-by-the-windows-time-service"></a>Windows 时间服务支持的硬件设备  
基于硬件的时钟（如 GPS 或无线电时钟）通常用作高度准确的引用时钟设备。 默认情况下，Windows 时间服务 NTP 时间提供程序不支持将硬件设备直接连接到计算机，尽管可以创建支持此连接类型的基于软件的独立时间提供程序。 这种类型的提供程序与 Windows 时间服务一起提供可靠的稳定时间引用。  
  
硬件设备（如 cesium 时钟或全球定位系统（GPS）接收器）通过遵循标准获取准确的时间定义来提供精确的当前时间。 Cesium 时钟非常稳定，不受诸如温度、压力和湿度等因素的影响，但也很昂贵。 GPS 接收方的操作开销更低，并且也是精确的引用时钟。 GPS 接收方从从 cesium 时钟获取时间的卫星中获取时间。 在不使用独立时间提供程序的情况下，Windows 时间服务器可以通过连接到通过电话或 Internet 连接到硬件设备的外部 NTP 服务器来获取其时间。 组织（例如美国海军天文台）提供连接到非常可靠的引用时钟的 NTP 服务器。  
  
许多 GPS 接收方和其他时间设备可以在网络上充当 NTP 服务器。 你可以将 AD DS 林配置为仅当这些外部硬件设备也充当网络上的 NTP 服务器时，才能从这些外部硬件设备同步时间。 为此，请将域控制器配置为林根中的主域控制器（PDC）仿真器，使其与 GPS 设备提供的 NTP 服务器同步。 为此，请参阅在[目录林根级域中的 PDC 模拟器上配置 Windows 时间服务](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731191%28v=ws.10%29)。  
  
### <a name="simple-network-time-protocol"></a>简单网络时间协议  
简单的网络时间协议（SNTP）是一种简化的时间协议，适用于不需要 NTP 提供一定程度的服务器和客户端。 SNTP 是更基本的 NTP 版本，是 Windows 2000 中使用的主要时间协议。 由于 SNTP 和 NTP 的网络数据包格式相同，这两种协议可互操作。 这两者之间的主要区别在于 SNTP 不具有 NTP 提供的错误管理和复杂筛选系统。 有关简单网络时间协议的详细信息，请参阅 IETF RFC 数据库中的 RFC 1769。  
  
### <a name="time-protocol-interoperability"></a>时间协议互操作性  
Windows 时间服务可在运行 Windows 2000、Windows XP 和 Windows Server 2003 的计算机的混合环境中运行，因为在 Windows 2000 中使用的 SNTP 协议可与 Windows XP 和 Windows Server 2003 中的 NTP 协议互操作。  
  
Windows NT Server 4.0 中名为 TimeServ 的时间服务在 Windows NT 4.0 网络之间同步时间。 TimeServ 是作为*Microsoft WINDOWS NT 4.0 资源工具包*的一部分提供的附加功能，不提供 Windows Server 2003 所需的时间同步的可靠性。  
  
Windows 时间服务可与运行 Windows NT 4.0 的计算机进行互操作，因为它们可以与运行 Windows 2000 或 Windows Server 2003 的计算机同步时间;但是，运行 Windows 2000 或 Windows Server 2003 的计算机不会自动发现 Windows NT 4.0 时间服务器。 例如，如果你的域配置为使用基于域层次结构的同步方法来同步时间，并且你希望域层次结构中的计算机与 Windows NT 4.0 域控制器同步时间，则必须配置这些手动与 Windows NT 4.0 域控制器同步的计算机。  
  
Windows NT 4.0 比 Windows 时间服务使用更简单的时间同步机制。 因此，为了确保跨网络准确地同步时间，建议将任何 Windows NT 4.0 域控制器升级到 Windows 2000 或 Windows Server 2003。  
  
## <a name="windows-time-service-processes-and-interactions"></a>Windows 时间服务进程和交互  

Windows 时间服务旨在同步网络上计算机的时钟。 网络时间同步过程也称为时间收敛，因为每台计算机从更准确的时间服务器访问时间。 时间收敛涉及到一个过程，授权服务器将当前时间以 NTP 数据包的形式提供给客户端计算机。 数据包中提供的信息指示是否需要对计算机的当前时钟时间进行调整，以便将其与更精确的服务器同步。  
  
作为时间汇聚过程的一部分，域成员将尝试与位于同一域中的任何域控制器同步时间。 如果计算机是域控制器，则它将尝试与更权威的域控制器进行同步。  
  
如果计算机运行 Windows XP Home Edition 或未加入域的计算机，则不会尝试与域层次结构同步，但会默认配置为从 time.windows.com 中获取时间。  
  
若要将运行 Windows Server 2003 的计算机建立为权威计算机，计算机必须配置为可靠时间源。 默认情况下，安装在 Windows Server 2003 域上的第一个域控制器将自动配置为可靠时间源。 由于它是域的权威计算机，因此必须将其配置为与外部时间源（而不是域层次结构）进行同步。 而且，默认情况下，所有其他 Windows Server 2003 域成员都配置为与域层次结构同步。  
  
建立 Windows Server 2003 网络后，你可以将 Windows 时间服务配置为使用以下同步选项之一：  
  
-   基于域层次结构的同步  
  
-   手动指定的同步源  
  
-   所有可用的同步机制  
  
-   无同步。  
  
下一节将讨论这些同步类型。  
  
### <a name="domain-hierarchy-based-synchronization"></a>基于域层次结构的同步  

基于域层次结构的同步使用 AD DS 域层次结构来查找同步时间所用的可靠来源。 根据域层次结构，Windows 时间服务确定每个时间服务器的准确性。 在 Windows Server 2003 林中，持有主域控制器（PDC）仿真器操作主机角色的计算机（位于目录林根级域中）保留最佳时间源的位置，除非已配置其他可靠时间源。 下图说明了域层次结构中的计算机之间的时间同步路径。  
  
**AD DS 层次结构中的时间同步**  
@no__t 0Windows Time @ no__t-1
  
#### <a name="reliable-time-source-configuration"></a>可靠时间源配置  
被配置为可靠时间源的计算机被标识为时间服务的根。 时间服务的根目录是域的权威服务器，通常配置为从外部 NTP 服务器或硬件设备检索时间。 可以将时间服务器配置为可靠时间源，以优化跨域层次结构传输时间的方式。 如果将域控制器配置为可靠时间源，Net Logon 服务会在登录到网络时将该域控制器公布为可靠时间源。 当其他域控制器查找要与之同步的时间源时，他们首先选择可靠的源（如果有）。  
  
#### <a name="time-source-selection"></a>选择时间源  
时间源选择进程可能会在网络上产生两个问题：  
  
-   其他同步周期。  
  
-   增加了网络流量中的音量。  
  
同步网络中的循环会在一组域控制器之间保持一致，同时在两个域控制器之间连续共享，而不会与其他可靠时间源重新同步。 Windows 时间服务的时间源选择算法旨在防范这些类型的问题。  
  
计算机使用以下方法之一来标识要与之同步的时间源：  
  
-   如果计算机不是域的成员，则必须将其配置为与指定的时间源同步。  
  
-   如果计算机是域中的成员服务器或工作站，则默认情况下，它将遵循 AD DS 层次结构，并将其时间与当前运行 Windows 时间服务的本地域中的域控制器进行同步。  
  
如果计算机是域控制器，则最多可以使用六个查询来查找要与之同步的另一域控制器。 每个查询旨在标识具有特定属性（如域控制器类型、特定位置以及是否是可靠时间源）的时间源。 时间源还必须遵守以下限制：  
  
-   可靠时间源只能与父域中的域控制器进行同步。  
  
-   PDC 模拟器可以在其自己的域或父域中的任何域控制器中与可靠时间源同步。  
  
如果域控制器无法与它所查询的域控制器的类型同步，则不进行查询。 域控制器知道它可以在进行查询之前从哪种类型的计算机获取时间。 例如，本地 PDC 模拟器不会尝试查询第三个或第六个数字，因为域控制器不会尝试自行同步。  
  
下表列出了域控制器用于查找时间源和查询执行顺序的查询。  
  
**域控制器时间源查询**  
  
|查询编号|域控制器|Location|时间源的可靠性|  
|----------------|---------------------|------------|------------------------------|  
|1|父域控制器|站点内|首选可靠的时间源，但如果全部可用，则它可以与非可靠时间源同步。|  
|2|本地域控制器|站点内|仅与可靠时间源同步。|  
|3|本地 PDC 模拟器|站点内|不适用。<br /><br />域控制器不会尝试自行同步。|  
|4|父域控制器|站点外|首选可靠的时间源，但如果全部可用，则它可以与非可靠时间源同步。|  
|5|本地域控制器|站点外|仅与可靠时间源同步。|  
|6|本地 PDC 模拟器|站点外|不适用。<br /><br />域控制器不会尝试自行同步。| 
  
**注意**  
  
-   计算机永远不会与其自身同步。 如果尝试同步的计算机是本地 PDC 模拟器，则它不会尝试查询3或6。  
  
每个查询都返回可用作时间源的域控制器的列表。 Windows 时间根据域控制器的可靠性和位置分配查询分数的每个域控制器。 下表列出了 Windows 时间分配给每种类型的域控制器的分数。  
  
**评分确定**  
  
|域控制器状态|分数|  
|----------------------------|---------|  
|位于同一站点中的域控制器|8|  
|被标记为可靠时间源的域控制器|4|  
|位于父域中的域控制器|2|  
|作为 PDC 模拟器的域控制器|1|  
  
当 Windows 时间服务确定它已确定具有最佳分数的域控制器时，将不再执行任何查询。 由时间服务分配的分数是累计的，这意味着位于同一站点中的 PDC 仿真器会获得九分数。  
  
如果时间服务的根未配置为与外部源同步，则该计算机的内部硬件时钟会控制该时间。  
  
### <a name="manually-specified-synchronization"></a>手动指定的同步  
手动指定的同步使你可以指定计算机获得时间的单个对等机或对等列表。 如果计算机不是域的成员，则必须手动将其配置为与指定的时间源同步。 默认情况下，作为域成员的计算机配置为从域层次结构中同步，手动指定的同步最适用于域的林根或未加入域的计算机。 手动指定与域的权威计算机同步的外部 NTP 服务器可提供可靠的时间。 但是，将域的权威计算机配置为与硬件时钟同步是一种更好的解决方案，可为你的域提供最准确、最安全的时间。  
  
手动指定的时间源在为其写入特定的时间提供程序时不会进行身份验证，因此这些源会容易受到攻击者的攻击。 此外，如果计算机与手动指定的源（而不是其身份验证域控制器）同步，则这两台计算机可能不同步，导致 Kerberos 身份验证失败。 这可能会导致要求网络身份验证的其他操作失败，如打印或文件共享。 如果只有林根配置为与外部源同步，则林中的所有其他计算机都保持同步，从而使重播攻击变得很困难。  
  
### <a name="all-available-synchronization-mechanisms"></a>所有可用的同步机制  

"所有可用的同步机制" 选项是网络上用户最有价值的同步方法。 此方法允许与域层次结构同步，如果域层次结构不可用，则还可能提供备用时间源，具体取决于配置。 如果客户端无法与域层次结构同步时间，则时间源将自动回退到由**NtpServer**设置指定的时间源。 这种同步方法最有可能为客户端提供准确的时间。  

### <a name="stopping-time-synchronization"></a>停止时间同步  
在某些情况下，您可能希望使计算机停止同步其时间。 例如，如果计算机尝试通过拨号连接从 Internet 上的某个时间源或通过 WAN 上的另一个站点同步，则可能会产生昂贵的电话费用。 禁用该计算机上的同步时，会阻止计算机尝试通过拨号连接访问时间源。  
  
你还可以禁用同步，以防止在事件日志中生成错误。 每次计算机尝试与不可用的时间源同步时，它会在事件日志中生成错误。 如果为计划的维护从网络中取出了时间源，并且不打算重新配置客户端以从其他源进行同步，则可以禁用客户端上的同步，以防止它在时间服务器时尝试同步不可用。  
  
在指定为同步网络的根的计算机上禁用同步非常有用。 这表示根计算机信任其本地时钟。 如果同步层次结构的根未设置为**NoSync** ，并且它无法与其他时间源同步，则客户端不会接受此计算机发出的数据包，因为它的时间不受信任。
  
即使客户端未与其他时间源同步，客户端也可以信任的唯一时间服务器是已由客户端标识为可靠时间服务器的服务器。  
  
### <a name="disabling-the-windows-time-service"></a>禁用 Windows 时间服务  
Windows 时间服务（W32Time）可以完全禁用。 如果选择实现使用 NTP 的第三方时间同步产品，则必须禁用 Windows 时间服务。 这是因为所有 NTP 服务器都需要访问用户数据报协议（UDP）端口123，只要 windows 时间服务运行在 Windows Server 2003 操作系统上，端口123将保留 Windows 时间。  
  
## <a name="network-ports-used-by-windows-time-service"></a>Windows 时间服务使用的网络端口  
Windows 时间服务在网络上进行通信，以确定可靠的时间源，获取时间信息，并向其他计算机提供时间信息。 它按照 NTP 和 SNTP Rfc 的定义执行此通信。  
  
**Windows 时间服务的端口分配**  
  
|服务名称|UDP|TCP|  
|----------------|-------|-------|  
|NTP|123|不可用|  
|SNTP|123|不可用|  
  
## <a name="see-also"></a>请参阅  
[Windows 时间服务技术参考](windows-time-service-tech-ref.md)
[Windows 时间服务工具和设置](Windows-Time-Service-Tools-and-Settings.md)
[Microsoft 知识库文章 902229](https://go.microsoft.com/fwlink/?LinkId=186066)