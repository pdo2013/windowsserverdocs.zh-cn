---
title: chkdsk
description: '适用于 * * * * 的 Windows 命令主题 '
ms.custom: na
ms.prod: windows-server
ms.reviewer: na
ms.suite: na
ms.technology: manage-windows-commands
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 62912a3c-d2cc-4ef6-9679-43709a286035
author: coreyp-at-msft
ms.author: coreyp
manager: lizapo
ms.date: 10/16/2017
ms.openlocfilehash: fac941a0ad5638fafa86d31a9af1cce1cc475823
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/27/2019
ms.locfileid: "71379437"
---
# <a name="chkdsk"></a>chkdsk

检查卷的文件系统和文件系统元数据，以查找逻辑错误和物理错误。 如果在没有参数的情况下使用， **chkdsk**只显示卷的状态，并且不会修复任何错误。 如果与 **/f**、 **/r**、 **/x**或 **/b**参数一起使用，则会修复卷上的错误。

> [!IMPORTANT]
> 本地**Administrators**组中的成员身份或等效身份是运行**chkdsk**所需的最低要求。 若要以管理员身份打开 "命令提示符" 窗口，请在 "开始" 菜单中右键单击 "**命令提示符**"，然后单击 "以**管理员身份运行**"。

> [!IMPORTANT]
> 不建议中断**chkdsk** 。 但是，取消或中断**chkdsk**不应使卷的损坏时间比运行**chkdsk**之前更多。 重新运行**chkdsk**检查并修复卷上的任何剩余损坏。

> [!IMPORTANT]
> **注意：** Chkdsk 只能用于本地磁盘。 此命令不能与已通过网络重定向的本地驱动器号一起使用。

有关如何使用此命令的示例，请参阅[示例](#examples)。

## <a name="syntax"></a>语法

```
chkdsk [<Volume>[[<Path>]<FileName>]] [/f] [/v] [/r] [/x] [/i] [/c] [/l[:<Size>]] [/b]  
```

## <a name="parameters"></a>Parameters

|      参数      |                                                                                                                      描述                                                                                                                       |
|---------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|      \<Volume >      |                                                                                     指定驱动器号（后跟冒号）、装入点或卷名。                                                                                     |
| [\<Path >] <FileName> | 仅用于文件分配表（FAT）和 FAT32。 指定您希望**chkdsk**检查碎片的文件或文件集的位置和名称。 您可以使用 **？** 和 **&#42;** 通配符来指定多个文件。 |
|         /f          |                             修复磁盘上的错误。 必须锁定磁盘。 如果**chkdsk**无法锁定驱动器，则会出现一条消息，询问您是否要在下次重新启动计算机时检查驱动器。                             |
|         /v          |                                                                                       检查磁盘时，显示每个目录中每个文件的名称。                                                                                        |
|         /r          |                                   查找坏扇区并恢复可读的信息。 必须锁定磁盘。 **/r**包括 **/f**的功能，并对物理磁盘错误进行额外的分析。                                   |
|         /x          |                                                  必要时强制首先卸除卷。 驱动器的所有打开的句柄都将失效。 **/x**还包括 **/f**的功能。                                                   |
|         i          |                                                           仅适用于 NTFS。 对索引条目执行更少的经历检查，这会减少运行**chkdsk**所需的时间。                                                            |
|         /c          |                                                          仅适用于 NTFS。 不检查文件夹结构内的循环，这会减少运行**chkdsk**所需的时间。                                                           |
|    /l [： \<Size >]     |                                                         仅适用于 NTFS。 将日志文件大小更改为你键入的大小。 如果省略 size 参数，则 **/l**显示当前大小。                                                          |
|         /b          |           仅 NTFS：清除卷上的坏簇列表，并重新扫描所有已分配和可用的群集以查找错误。 **/b**包括 **/r**的功能。 在将卷镜像到新硬盘驱动器之后，使用此参数。            |
|         /?          |                                                                                                          在命令提示符下显示帮助。                                                                                                          |

## <a name="remarks"></a>备注

- 跳过卷检查

  **/I**或 **/c**开关通过跳过某些卷检查来减少运行**chkdsk**所需的时间。
- 重新启动时检查锁定的驱动器

  如果希望**chkdsk**更正磁盘错误，则无法在驱动器上打开文件。 如果文件已打开，则显示以下错误消息：

  ```
  Chkdsk cannot run because the volume is in use by another process. Would you like to schedule this volume to be checked the next time the system restarts? (Y/N)  
  ``` 

  如果选择在下次重新启动计算机时检查驱动器，则**chkdsk**会在重新启动计算机时自动检查驱动器并更正错误。 如果驱动器分区是启动分区，则在它检查驱动器后， **chkdsk**会自动重新启动计算机。

  你还可以使用**chkntfs/c**命令计划下次重新启动计算机时要检查的卷。 使用**fsutil dirty set**命令可设置卷的脏位（指示损坏），以便 Windows 在计算机重新启动时运行**chkdsk** 。
- 报告磁盘错误

  你应偶尔在 FAT 和 NTFS 文件系统上使用**chkdsk**来检查磁盘错误。 **Chkdsk**检查磁盘空间和磁盘使用情况，并提供特定于每个文件系统的状态报告。 状态报告显示在文件系统中找到的错误。 如果在活动分区上不使用 **/f**参数运行**chkdsk** ，它可能会报告虚假错误，因为它无法锁定驱动器。
- 解决逻辑磁盘错误

  只有在指定 **/f**参数时， **Chkdsk**才能更正逻辑磁盘错误。 **Chkdsk**必须能够锁定驱动器以纠正错误。

  由于 FAT 文件系统上的修复通常会更改磁盘的文件分配表，有时会导致数据丢失，因此， **chkdsk**可能会显示类似于以下内容的确认消息：

  ```
  10 lost allocation units found in 3 chains.  
  Convert lost chains to files?  
  ``` 

  如果按 " **Y**"，Windows 会将根目录中的每个丢失的链保存为文件，文件名格式为 @ no__t-1nnnn > .chk。 **Chkdsk**完成后，可以检查这些文件，查看它们是否包含所需的任何数据。 如果按**N**，Windows 将修复磁盘，但不会保存丢失的分配单元的内容。

  如果不使用 **/f**参数， **chkdsk**将显示一条消息，指出需要修复文件，但不会修复任何错误。

  如果在非常大的磁盘或包含大量文件（例如，数百万个文件）的磁盘上使用**chkdsk/f** ， **chkdsk/f**可能需要较长时间才能完成。

- 查找物理磁盘错误

  使用 **/r**参数查找文件系统中的物理磁盘错误，并尝试从任何受影响的磁盘扇区恢复数据。

- 将**chkdsk**用于打开的文件

  如果指定 **/f**参数，则当磁盘上存在打开的文件时， **chkdsk**会显示错误消息。 如果未指定 **/f**参数并且打开的文件存在，则**chkdsk**可能会报告磁盘上丢失的分配单元。 如果打开的文件尚未记录在文件分配表中，则可能会发生这种情况。 如果**chkdsk**报告大量分配单元丢失，请考虑修复磁盘。

- 将**chkdsk**与共享文件夹的卷影副本配合使用

  由于在启用共享文件夹的卷影副本时无法锁定共享文件夹的卷影副本源卷，因此针对源卷运行**chkdsk**可能会报告错误或导致**chkdsk**意外退出。 但是，可以通过在只读模式（不带参数）下运行**chkdsk**来检查卷影副本是否存在错误，以检查共享文件夹的卷影副本存储卷。

- 了解退出代码

  下表列出了**chkdsk**在完成后报告的退出代码。  

  | 退出代码 |                                                   描述                                                    |
  |-----------|------------------------------------------------------------------------------------------------------------------|
  |     0     |                                              未发现任何错误。                                               |
  |     1     |                                           发现并修复了错误。                                           |
  |     2     | 执行了磁盘清理（如垃圾收集）或未执行清理，因为未指定 **/f** 。 |
  |     3     | 无法检查磁盘，无法修复错误，或由于未指定 **/f**而导致错误未修复。  |


- 可从恢复控制台获取带有不同参数的**chkdsk**命令。
- 在不经常重新启动的服务器上，可能需要使用**chkntfs**或**fsutil 脏 query**命令来确定是否已在运行 chkdsk 之前设置了卷的脏位。

## <a name="examples"></a>示例

如果要检查驱动器 D 中的磁盘并让 Windows 修复错误，请键入：

```
chkdsk d: /f  
```

如果遇到错误， **chkdsk**将暂停并显示消息。 **Chkdsk**通过显示列出磁盘状态的报告完成。 在**chkdsk**完成之前，无法打开指定驱动器上的任何文件。

若要在当前目录中的非连续块中检查 FAT 磁盘上的所有文件，请键入：

```
chkdsk *.*  
```

**Chkdsk**显示状态报告，然后列出与具有非连续块的文件规范匹配的文件。
#### <a name="additional-references"></a>其他参考

[命令行语法项](command-line-syntax-key.md)
