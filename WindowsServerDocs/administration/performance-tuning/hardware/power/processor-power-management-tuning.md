---
title: Windows Server 平衡电源计划的处理器电源管理（PPM）优化
description: Windows Server 平衡电源计划的处理器电源管理（PPM）优化
ms.prod: windows-server
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: Qizha;TristanB
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 53399c1ff1d9fa60df992b922b99c82d119b2f58
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/27/2019
ms.locfileid: "71355033"
---
# <a name="processor-power-management-ppm-tuning-for-the-windows-server-balanced-power-plan"></a>Windows Server 平衡电源计划的处理器电源管理（PPM）优化

从 Windows Server 2008 开始，Windows Server 提供了三个电源计划：**平衡**、**高性能**和**节能程序**。 "**平衡**" 电源计划是默认选择，旨在为一组典型服务器工作负荷提供最佳能效。 本主题介绍了用于确定过去几个 Windows 版本的**均衡**方案的默认设置的工作负荷。

如果你运行的服务器系统的工作负载特征或性能和电源要求明显不同于这些工作负载，则你可能需要考虑优化默认电源设置（即创建自定义电源计划）。 有一种有用的优化信息源是[服务器硬件电源注意事项](../power.md)。 或者，您也可以决定将**高性能**电源计划作为您的环境的最佳选择，认识到您可能会在 exchange 中消耗很大的能源，以提高响应能力。

> [!IMPORTANT]
> 你应利用 Windows Server 中包含的电源策略，除非你具有创建自定义项的特定需求，并非常了解你的结果会因工作负荷的特征而异。

## <a name="windows-processor-power-tuning-methodology"></a>Windows 处理器电源优化方法


### <a name="tested-workloads"></a>测试的工作负载

选择工作负荷是为了涵盖一组 "典型" Windows Server 工作负荷的最大工作量。 显然，这一集并不代表真实的整个服务器环境。

每个电源策略中的优化都由以下五个工作负荷驱动：

-   **IIS Web 服务器工作负荷**

    Microsoft 内部基准测试（称为 Web 基础）用于优化运行 IIS Web 服务器的平台的能源效率。 安装程序包含一个 web 服务器和多个模拟 web 访问流量的客户端。 动态、静态热（内存中）和静态冷（所需的磁盘访问）网页的分布基于生产服务器的统计调查。 若要将服务器的 CPU 内核推送到完全利用率（已测试的频谱的一端），安装程序需要足够的网络和磁盘资源。

-   **SQL Server 数据库工作负荷**

    [TPC-E](http://www.tpc.org/tpce/default.asp)基准是用于数据库性能分析的一种流行的基准。 它用于生成针对 PPM 优化优化的 OLTP 工作负荷。 此工作负荷的磁盘 i/o 非常重要，因此，对存储系统和内存大小具有高性能要求。

-   **文件服务器工作负荷**

    Microsoft 开发的基准测试（称为[FSCT](http://www.snia.org/sites/default/files2/sdc_archives/2009_presentations/tuesday/BartoszNyczkowski-JianYan_FileServerCapacityTool.pdf) ）用于生成 SMB 文件服务器工作负荷。 它在服务器上创建一个大型文件集，并使用许多客户端系统（实际或虚拟化）来生成文件打开、关闭、读取和写入操作。 操作组合基于生产服务器的统计调查。 它强调 CPU、磁盘和网络资源。

-   **SPECpower – JAVA 工作负荷**

    [SPECpower\_ssj2008](http://spec.org/power_ssj2008/)是第一个行业标准规范基准，可共同评估电源和性能特征。 它是具有不同 CPU 负载级别的服务器端 Java 工作负荷。 它不需要很多磁盘或网络资源，但它对内存带宽有一定的要求。 几乎所有 CPU 活动都在用户模式下执行;内核模式活动对性能和性能特征的影响不大，但电源管理决策除外。

-   **应用程序服务器工作负荷**

    [SAP-SD](http://global.sap.com/campaigns/benchmark/index.epx)基准用于生成应用程序服务器工作负荷。 将使用双层设置，并且数据库和应用程序服务器位于同一服务器主机上。 此工作负荷还利用响应时间作为性能指标，这与其他已测试的工作负载不同。 因此，它用于验证 PPM 参数对响应性的影响。 尽管如此，它并不代表所有延迟敏感的生产工作负荷。

除 SPECpower 外的所有基准都最初是为进行性能分析而设计的，因此，这种基准是在负载最大负载级别运行的。 不过，对于实际的生产服务器来说，"中型" 和 "常规" 负载级别更常见，对于**平衡**计划优化更具吸引力。 我们有意使用各种阻止方法（例如，通过减少活动用户/客户端数），在不同负载100级别（即，在 10% 的步骤中）运行基准测试。

### <a name="hardware-configurations"></a>硬件配置

对于每个版本的 Windows，在电源计划分析和优化过程中都使用最新的生产服务器。 在某些情况下，这些测试在发布计划与下一 Windows 版本匹配的预生产系统上执行。

假设大多数服务器都是使用1到4个处理器套接字进行销售的，而且由于升级后的服务器不太可能是主要问题，因此，电源计划优化测试主要在2插槽和4插槽系统上运行。 为每个测试选择 RAM、磁盘和网络资源的数量，以允许每个系统运行到其完整容量，同时考虑通常适用于现实世界服务器环境的成本限制，例如保留配置合理。

> [!IMPORTANT]
> 尽管系统可以在其峰值负载下运行，但我们通常会优化较低的负载级别，因为在高性能的负载级别始终运行的服务器将很好地使用**高性能**电源计划，除非能量效率较高大事.

### <a name="metrics"></a>指标

所有测试的基准都使用吞吐量作为性能指标。 响应时间被视为对这些工作负荷的 SLA 要求（SAP 除外，它是主要指标）。 例如，如果平均或最大响应时间小于特定值，则将基准运行视为 "有效"。

因此，PPM 调谐分析还使用吞吐量作为其性能指标。  在最高的负载级别（100% 的 CPU 使用率），我们的目标是吞吐量不应超过几个百分比，因为电源管理优化。 但主要的考虑因素是在中等负载级别和低负载级别最大限度地提高能效（如下所定义）。

![能效公式](../../media/serverperf-ppm-formula.jpg)

以较低频率运行 CPU 内核可降低能耗。 但是，低频率通常会降低吞吐量并缩短响应时间。 对于**平衡**的电源计划，有一种故意的响应能力和电源效率。 SAP 工作负荷测试以及其他工作负荷的响应时间 Sla，请确保这些特定工作负载的响应时间增加不会超过特定的阈值（例如 5%）。

> [!NOTE]
> 如果工作负荷使用响应时间作为性能指标，则系统应切换到 "**高性能**" 电源计划或更改**均衡**电源计划，如[建议用于快速响应的均衡电源计划参数中所述Time](recommended-balanced-plan-parameters.md)。

### <a name="tuning-results"></a>优化结果

从 Windows Server 2008 开始，Microsoft 与 Intel 和 AMD 合作，为每个 Windows 版本优化最新服务器处理器的 PPM 参数。 在前面讨论的每个工作负荷上对大量的 PPM 参数组合进行了测试，以在不同负载级别上查找最佳节能。 随着软件算法经过优化并随着硬件电源体系结构的发展，每个新的 Windows Server 始终具有比以前版本更好或更高的能源效率。

下图举例说明了在运行 Windows Server 2008 R2 的4插槽生产服务器上的不同 TPC E 负载级别下的能源效率。 与 Windows Server 2008 相比，它在中等负载级别上显示了 8% 的改善。

![能效比较](../../media/serverperf-ppm-figure1.jpg)

## <a name="customized-tuning-suggestions"></a>自定义优化建议

如果主要工作负荷特征与用于默认**平衡**电源计划 ppm 优化的五个工作负荷有明显差别，则可以通过更改一个或多个 ppm 参数来进行试验，以便找到最适合您的环境。

由于参数的数量和复杂性，这可能是一种颇具挑战性的任务，但如果您正在寻找在您的特定环境下的能源消耗与工作负荷效力之间的最佳平衡点，那就很值得。

 可在[处理器电源管理优化](https://msdn.microsoft.com/windows/hardware/gg566941.aspx)中找到完整的可调式 PPM 参数集。 要启动的一些最简单的电源参数可能是：

-   **处理器性能增加阈值和处理器性能增加时间**–较大的值会降低性能响应增加的活动

-   **处理器性能降低阈值**–大值 quicken 将电源响应到空闲期

-   **处理器性能降低时间**–更大的值会在空闲期间更多地逐渐降低性能

-   **处理器性能增加策略**– "单个" 策略会减缓对增加和持续活动的性能响应。"火箭" 策略可快速响应增加的活动

-   **处理器性能降低策略**– "单个" 策略在更长的空闲时间段内更进一步降低了性能;进入空闲期时，"火箭" 策略会极快地断开电源

>[!Important]
> 在开始任何试验之前，您应该首先了解工作负荷，这将帮助您做出正确的 PPM 参数选择，并减少优化工作量。

### <a name="understand-high-level-performance-and-power-requirements"></a>了解高级性能和电源要求

如果你的工作负荷为 "实时" （例如，容易受到 glitching 或其他对最终用户的影响）或具有非常严格的响应能力要求（例如，股票经纪人），并且如果能源消耗不是你的环境的主要标准，你可能会只需切换到**高性能**电源计划。 否则，你应该了解工作负荷的响应时间要求，并调整 PPM 参数以获得仍满足这些要求的最佳电源效率。

### <a name="understand-underlying-workload-characteristics"></a>了解底层工作负荷特征

你应了解工作负荷并设计用于优化的试验参数集。 例如，如果需要将 CPU 核心的频率 ramped 得非常快（或许你有一个突发的工作负荷，其中包含非常长的空闲时间段，但当新事务出现时，你需要快速响应），然后处理器性能增加策略可能需要设置为 "火箭" （顾名思义，它会将 CPU 核心频率桃为其最大值，而不是在一段时间内进行单步执行）。

如果你的工作负荷非常突发，则可以减少 PPM 检查间隔，以使 CPU 频率在突然到达后开始更快地启动。 如果你的工作负荷的线程并发性不高，则可以启用核心休止来强制在较少数量的内核上执行工作负荷，这也可能会提高处理器缓存命中率。

如果只是想要在中等利用率级别（即，不是光线工作负荷级别）增加 CPU 频率，则可以将处理器性能增加/降低阈值调整为在观察到特定级别的活动之前不做出反应。

### <a name="understand-periodic-behaviors"></a>了解定期行为

对于白天和夜间或周末，可能有不同的性能要求，或者可能存在不同时间运行的不同工作负荷。 在这种情况下，一组 PPM 参数对于所有时间段可能不是最佳的。 由于可以设计多个自定义电源计划，因此甚至可以针对不同的时间段进行调整，还可以通过脚本或其他动态系统配置方式在电源计划之间切换。

同样，这也增加了优化过程的复杂性，因此，有一个问题需要从这种类型的优化中获得多少价值，在有重大的硬件升级或工作负载变化时，可能需要重复这些值。

这就是 Windows 第一次提供**均衡**的电源计划的原因，因为在许多情况下，可能不需要对特定服务器上的特定工作负荷进行手动调整。

## <a name="see-also"></a>请参阅
- [服务器硬件性能注意事项](../index.md)
- [服务器硬件电源注意事项](../power.md)
- [电源和性能优化](power-performance-tuning.md)
- [处理器电源管理优化](processor-power-management-tuning.md)
- [建议的平衡计划参数](recommended-balanced-plan-parameters.md)
