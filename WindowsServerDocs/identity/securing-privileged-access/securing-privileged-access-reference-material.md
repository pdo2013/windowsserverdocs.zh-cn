---
title: 保护特权访问参考资料
description: 为 Windows Server Active Directory 域的操作的安全控制
ms.prod: windows-server-threshold
ms.topic: article
ms.assetid: 22ee9a77-4872-4c54-82d9-98fc73a378c0
ms.date: 02/14/2019
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: mas
ms.openlocfilehash: bcc06a3ccc4e95fa43a7f8f0ef7d110fd427f5a0
ms.sourcegitcommit: cd12ace92e7251daaa4e9fabf1d8418632879d38
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/04/2019
ms.locfileid: "66501654"
---
# <a name="active-directory-administrative-tier-model"></a>Active Directory 管理层模型

>适用于：Windows Server

此层模型的目的是保护标识系统使用一系列环境 （第 0 层） 的完全控制和攻击者经常破坏的高风险工作站资产之间的缓冲区区域。

![层模型的三个层图示](../media/securing-privileged-access-reference-material/PAW_RM_Fig1.JPG)

此层模型由三个级别组成，只包含管理帐户而不包含标准用户帐户：

- **第 0 层** - 直接控制环境中的企业标识。 第 0 层包括帐户、组以及对 Active Directory 林、域或域控制器及其中的所有资产具有直接或间接管理控制权的其他资产。 第 0 层中所有资产的安全敏感性是等同的，因为它们均可以有效地相互控制。
- **第 1 层** - 控制企业服务器和应用程序。 第 1 层资产包括服务器操作系统、云服务和企业应用程序。 第 1 层的管理员帐户能够管理控制这些资产上托管的大量业务价值。 常见的示例角色是服务器管理员，此角色可维护这些操作系统并能够影响所有企业服务。
- **第 2 层** - 控制用户工作站和设备。 第 2 层的管理员帐户对用户工作站和设备上托管的大量业务价值具有管理控制权。 示例包括技术支持和计算机支持管理员，因为它们可以影响几乎任何用户数据的完整性。

> [!NOTE]
> 这些层还可以充当保护管理资产的基本优先级机制，但一定要注意，能够控制任何层中所有资产的攻击者可以访问大多数或所有业务资产。 将其作为基本优先级机制非常有用的原因是，攻击者面临的困难/成本。 如果必须访问各个工作站或用户设备（第 2 层）来获取你组织的数据，则攻击者可以更加容易地完全控制所有标识（第 0 层）或服务器和云服务（第 1 层）。

## <a name="containment-and-security-zones"></a>控制和安全区域

这些层对应于某个特定安全区域。 虽然它们已经用过许多名称，但安全区域是一个行之有效的方法，可通过在它们之间设置网络层隔离来控制安全威胁。 此层模型通过在网络隔离无效的安全区域内控制攻击来弥补隔离。 安全区域可以同时跨本地和云基础结构，例如，位于同一域中的域控制器和域成员托管在本地和 Azure 中。

![安全区域如何跨本地和云基础结构图示](../media/securing-privileged-access-reference-material/PAW_RM_Fig2.JPG)

此层模型通过限制管理员可控制的范围和可登录的位置来防止特权提升（因为登录到计算机会授予相应权限以控制相关凭据和这些凭据管理的所有资产）。

### <a name="control-restrictions"></a>控制限制

控制限制如下图所示：

![控制限制图示](../media/securing-privileged-access-reference-material/PAW_RM_Fig3.JPG)

### <a name="primary-responsibilities-and-critical-restrictions"></a>主要职责和关键限制

**第 0 层管理员** - 管理标识存储以及可有效控制它的一小部分系统，并且：

- 可以根据需要管理和控制任何级别的资产
- 仅能够以交互方式登录或访问第 0 层级别的受信任资产

**第 1 层管理员** - 管理企业服务器、服务和应用程序，并且：

- 只能管理和控制第 1 层或第 2 层级别的资产
- 只能访问第 1 层或第 0 层级别的受信任资产（通过网络登录类型）
- 只能以交互方式登录到第 1 层级别的受信任资产

**第 2 层管理员** - 管理企业台式机、便携式计算机、打印机和其他用户设备，并且：

- 只能管理和控制第 2 层级别的资产
- 可以根据需要访问任何级别的资产（通过网络登录类型）
- 只能以交互方式登录到第 2 层级别受信任的资产

### <a name="logon-restrictions"></a>登录限制

登录限制如下图所示：

![登录限制图示](../media/securing-privileged-access-reference-material/PAW_RM_Fig4.JPG)

> [!NOTE]
> 请注意，某些资产可能对环境的可用性产生第 0 层影响，但不会直接影响资产的机密性或完整性。 其中包括 DNS 服务器服务和 Internet 代理之类的关键网络设备。

## <a name="clean-source-principle"></a>清洁源原则

“清洁源”原则要求所有安全依赖关系与受保护的对象一样可信。

![控制对象的使用者的安全与该对象的依赖关系图示](../media/securing-privileged-access-reference-material/PAW_RM_Fig5.JPG)

控制对象的任何使用者均是该对象的安全依赖关系。 如果攻击者可以控制的任何内容能够有效控制目标对象，则他们可以控制该目标对象。 因此，必须确保所有安全依赖关系处于或高于对象本身所需的安全级别。

虽然原则上很简单，但应用这一原则需要了解相关资产（对象）的控制关系并对其执行依赖关系分析以发现所有安全依赖关系（使用者）。

由于控制是可传递的，这一原则必须不断重复递归。 例如，如果 A 控制 B，而 B 控制 C，则 A 还间接控制 C。

![A 控制 B、B 控制 C，A 也间接控制 C 的方式图示](../media/securing-privileged-access-reference-material/PAW_RM_Fig6.JPG)

破坏 A 的攻击者可以访问 A 控制的所有内容（包括 B）以及 B 控制的所有内容（包括 C）。 在此示例中使用安全依赖关系的语言，B 和 A 均是 C 的安全依赖项，并且必须在 C 所需的保证级别对这两个依赖项进行保护，以使 C 具有相应的保证级别。

对于 IT 基础结构和标识系统，应将这一原则应用于最常见的控制方式中，包括安装有系统的硬件、系统的安装介质、体系结构和系统配置以及日常操作。

## <a name="clean-source-for-installation-media"></a>安装介质的清洁源

![安装媒体的清洁源图示](../media/securing-privileged-access-reference-material/PAW_RM_CSIM.JPG)

将清洁源原则应用于安装介质时，必须确保自制造商发布以来安装介质一直没有被篡改（尽可能确定这一点）。 下图描述了攻击者如何使用此路径来破坏计算机：

![攻击者使用路径破坏计算机图](../media/securing-privileged-access-reference-material/PAW_RM_Fig8.JPG)

将清洁源原则应用于安装介质时，需要验证在你拥有它的整个周期（包括购置、存储、传输和使用）内软件的完整性。

### <a name="software-acquisition"></a>软件购置

应通过以下方法之一验证软件来源：

- 软件从已知的制造商或可信来源的物理介质处获取，通常制造的介质从供应商处发送。
- 软件从 Internet 获取，并使用供应商提供的文件哈希得到验证。
- 软件从 Internet 获取，并通过下载和比较两个独立副本得到验证：
   - 下载到没有安全关系的两个主机（不在同一个域中，且不受相同工具管理），最好是从单独的 Internet 连接下载。
   - 比较使用 certutil 之类的实用程序将下载的文件：  `certutil -hashfile <filename>`

如果可能，应用程序安装程序和工具等所有应用程序软件应将 Windows Authenticode 与 [Windows Sysinternals](https://www.microsoft.com/sysinternals) 工具、*sigcheck.exe* 和吊销检查结合使用以进行数字签名和验证。 如果供应商无法提供此类数字签名，则可能需要一些软件。

### <a name="software-storage-and-transfer"></a>软件存储和传输

获取软件后，应将其存储在防修改的位置，尤其要防止被 Internet 连接的主机或被低于将安装软件或操作系统的系统级别的受信任人员进行修改。 此存储可以是物理介质或安全的电子位置。

### <a name="software-usage"></a>软件使用

理想情况下，应在使用软件时对其进行验证，如针对配置管理工具对其进行手动安装和打包或导入到配置管理工具中。

## <a name="clean-source-for-architecture-and-design"></a>体系结构和设计的清洁源

将清洁源原则应用于系统体系结构时，要求确保系统不依赖于较低的信任系统。 系统可以依赖于较高的信任系统，但不能依赖于具有较低安全标准的较低信任系统。

例如，可接受 Active Directory 控制标准用户桌面，但让 Active Directory 控制标准用户桌面会存在严重的特权提升风险。

![系统如何可依赖于较高的信任系统，但不能依赖于具有较低安全标准的较低信任系统图示](../media/securing-privileged-access-reference-material/PAW_RM_Fig09.JPG)

可以通过许多方式引入控制关系，包括文件系统等对象上的安全访问控制列表 (ACL)、计算机上本地管理员组中的成员身份或作为系统运行的计算机上安装的代理（能够运行任意代码和脚本）。

一个经常被忽视的示例是通过登录被公开，这会通过向其他系统公开某一系统的管理凭据来创建控制关系。 这是发生凭据被盗攻击（如传递哈希）危害如此之大的根本原因。 当管理员使用第 0 层凭据登录到标准用户桌面时，它们会向此桌面公开相应凭据，使 AD 对其进行控制并针对 AD 创建特权提升路径。 有关这些攻击的详细信息，请参阅[此页面](https://technet.microsoft.com/security/dn785092)。

由于大量资产依赖于标识系统（如 Active Directory），应将 Active Directory 和域控制器依赖的系统数量降至最低。

![应尽量减少 Active Directory 和域控制器依赖的系统数量图示](../media/securing-privileged-access-reference-material/PAW_RM_Fig010.JPG)

有关强化 Active Directory 前几大风险的详细信息，请参阅[此页面](http://aka.ms/hardenAD)。

## <a name="operational-standards-based-on-clean-source-principle"></a>基于清洁源原则的操作标准

本部分介绍管理人员的操作标准和期望。 这些标准旨在保护组织信息技术系统的管理控制，避免操作做法和过程可能造成的风险。

![标准旨在保护组织信息技术系统的管理控制，以避免操作做法和过程可能造成风险图示](../media/securing-privileged-access-reference-material/PAW_RM_Fig11.JPG)

### <a name="integrating-the-standards"></a>集成标准

可以将这些标准集成到组织的总体标准和做法中。 可以根据特定要求、可用工具和组织的风险偏好对其进行调整，但我们建议只进行最小限度的修改以降低风险。 我们建议你使用本指南的默认设置作为基准以实现理想的最终状态，并根据预期按优先级顺序管理任何增量。

标准指南分为以下各部分：

- 假设
- 变更咨询委员会
- 操作做法
   - 总结
   - 标准详细信息

### <a name="assumptions"></a>假设

本部分中的标准假设组织具有以下属性：

- 作用域中的大多数或所有服务器和工作站加均已入 Active Directory 中。
- 要管理的所有服务器都运行 Windows Server 2008 R2 或更高版本，并且已启用 RDP RestrictedAdmin 模式。
- 要管理的所有工作站都运行 Windows 7 或更高版本，并且已启用 RDP RestrictedAdmin 模式。

   > [!NOTE]
   > 要启用 RDP RestrictedAdmin 模式，请参阅[此页面](http://aka.ms/RDPRA)。

- 智能卡可用且已颁发给所有管理帐户。
- 每个域的 *Builtin\Administrator* 已被指定为紧急访问帐户
- 企业标识管理解决方案已部署。
- [LAPS](http://aka.ms/laps) 已部署到服务器和工作站来管理本地管理员帐户密码
- 已有特权访问管理解决方案（如 Microsoft 标识管理器），或者计划采用此解决方案。
- 已分配人员监视安全警报并对其做出响应。
- 存在可用技术功能以快速应用 Microsoft 安全更新。
- 将不使用服务器上的基板管理控制器，或将严格遵守安全控制。
- 服务器的管理员帐户和组（第 1 层管理员）和工作站（第 2 层管理员）将由域管理员（第 0 层）进行管理。
- 已有变更咨询委员会 (CAB) 或其他指定机构以批准 Active Directory 更改。

### <a name="change-advisory-board"></a>变更咨询委员会

变更咨询委员会 (CAB) 是一个针对可能影响组织安全配置文件的更改而成立的讨论论坛和批准机构。 这些标准的任何例外情况均应提交给 CAB 并提供风险评估和理由。

本文档中的每个标准按达到给定层级别标准的严重性进行区分。

![给定层级别标准图示](../media/securing-privileged-access-reference-material/PAW_RM_Fig12.JPG)

强制项 （用红色八边形或本文档中的橙色三角形标记） 的所有异常都被都视为是临时的并且它们需要由 CAB 批准。 准则包括：

- 初始请求需要相关人员的直属上司签名接受理由正当的风险，并且在六个月后过期。
- 续订需要提供正当理由并由业务部门主管签名接受风险，并且在六个月后过期。

建议项 （与本文档中的黄色圆圈标记） 的所有异常都被视为是临时的且需由 CAB 批准。 准则包括：

- 初始请求需要相关人员的直属上司签名接受理由正当的风险，并且在 12 个月后过期。
- 续订需要提供正当理由并由业务部门主管签名接受风险，并且在 12 个月后过期。

### <a name="operational-practices-standards-summary"></a>操作做法标准摘要

此表中的层列指管理帐户的层级别，其控制权限通常会影响该层中的所有资产。

![管理帐户的层级别表](../media/securing-privileged-access-reference-material/PAW_RM_Fig13.JPG)

定期制定操作决策对维护环境的安全状况至关重要。 这些过程和做法的标准有助于确保操作错误不会导致环境中出现可利用的操作漏洞。

#### <a name="administrator-enablement-and-accountability"></a>管理员支持和责任

管理员必须具备相关知识、获得授权、受过培训并负责尽可能安全地操作该环境。

##### <a name="administrative-personnel-standards"></a>管理人员标准

必须审查分配的管理人员，以确保他们是可信任的且需要管理权限：

- 在分配管理权限之前，对相关人员执行背景调查。
- 按季度审查管理权限以确定哪些人员仍有合法的业务需求，需要管理访问权限。

##### <a name="administrative-security-briefing-and-accountability"></a>管理安全简介和责任

管理员必须具有相关知识且负责管理与组织及其角色相关的风险。 管理员应每年接受以下培训：

- 常规威胁环境
   - 确定攻击
   - 攻击技术，包括传递哈希和凭据被盗
- 特定于组织的威胁和事件
- 管理员在防止攻击中扮演的角色
   - 利用层模型管理凭据公开
   - 使用管理工作站
   - 使用远程桌面协议 RestrictedAdmin 模式
- 特定于组织的管理做法
   - 查看此标准中的所有操作指南
   - 实施以下关键规则：
      - 请勿在管理工作站之外的其他设备上使用管理帐户
      - 请勿禁用或取消帐户或工作站上的安全控件（例如，登录限制或智能卡所需的属性）
      - 报告问题或异常活动

为了确保责任到人，使用管理帐户的所有人员均应签署管理权限行为准则，表明自己会遵循特定于组织的管理策略条例。

##### <a name="provisioning-and-deprovisioning-processes-for-administrative-accounts"></a>管理帐户的设置和取消设置过程

必须满足以下标准才可满足生命周期要求。

- 必须由下表中列出的批准机构审核所有管理帐户。
   - 只有当某一人员有合法业务需求，需要管理权限时，才可予以批准。
   - 管理权限批准期限不应超过六个月。
- 在以下情况下必须立即撤消管理权限：
   - 人员更改职位。
   - 人员离开组织。
- 在人员离开组织后必须立即禁用帐户。
- 必须在六个月内删除已禁用的帐户，删除记录必须录入变更批准委员会记录。
- 按月审查所有授权帐户成员身份，以确保未授予任何未经授权的权限。 可以通过在发生更改时发出警报的自动化工具取代此操作。

|帐户权限级别|批准机构|成员身份审查频率|
|--------------|------------|----------------|
|第 0 层管理员|变更批准委员会|每月或自动|
|第 1 层管理员|第 0 层管理员或安全性|每月或自动|
|第 2 层管理员|第 0 层管理员或安全性|每月或自动|

#### <a name="operationalize-least-privilege"></a>实施最低权限

这些标准通过减少角色中的管理员数量和他们具有权限的时间期限，帮助实现最低权限。

> [!NOTE]
> 要在组织中实现最低权限，需要了解组织的角色及其要求和设计机制，以确保他们能够使用最低权限完成其工作。 在管理模型中始终实现最低权限状态需要使用多种方法：
>
> - 限制特权组的管理员或成员数量
> - 给帐户委派较少的权限
> - 按需提供有时间限制的权限
> - 向其他人员提供执行任务的能力（看门人方法）
> - 提供针对紧急访问和极少使用情形的流程

##### <a name="limit-count-of-administrators"></a>限制管理员数量

应为每个管理角色至少分配两个合格的人员，以确保业务连续性。

如果分配给任何角色的人员数量超过两个，变更批准委员会必须批准具体理由，才可将权限分配给每个单独的成员（包括原始的两个）。 批准的理由必须包括：

- 管理员执行的哪些技术任务需要管理权限
- 执行任务的频率
- 为什么不能由其他管理员代为执行任务
- 记录所有其他已知的授予权限的方法以及为何每个方法均不可接受

##### <a name="dynamically-assign-privileges"></a>动态分配权限

要求管理员“实时”获取权限，确保在执行任务时方可使用。 任何权限均不会永久分配给管理帐户。

> [!NOTE]
> 永久分配的管理权限会自然而然地形成“大多数权限”策略，因为管理人员需要快速获取权限，以便在出现问题时维持操作可用性。 实时权限能够：
>
> - 更精细地分配权限，更加接近最低权限。
> - 减少权限的公开时间
> - 跟踪权限使用以检测滥用或攻击。

#### <a name="manage-risk-of-credential-exposure"></a>管理凭据公开的风险

使用以下做法来正确管理凭据公开的风险。

##### <a name="separate-administrative-accounts"></a>单独的管理帐户

被授予管理权限的所有人员必须具有与用户帐户不同的单独帐户来使用管理功能。

- **标准用户帐户** - 针对标准用户任务授予的标准用户权限，例如电子邮件、Web 浏览和使用业务线应用程序。 这些帐户不应被授予管理权限。
- **管理帐户** - 针对分配有相应管理权限的人员创建的单独帐户。 需要管理各层中的资产管理员应具有针对每个层的单独帐户。 这些帐户应无权访问电子邮件或公共 Internet。

##### <a name="administrator-logon-practices"></a>管理员登录做法

在管理员能够以交互方式登录到主机（通过标准 RDP 在本地登录、使用 RunAs 登录或使用虚拟化控制台登录）之前，该主机必须满足或高于管理员帐户层（或更高层）的标准。

管理员只能使用其管理帐户登录到管理工作站。 管理员只能通过使用下一部分所述的已批准的支持技术登录到受管理的资源。

> [!NOTE]
> 这是必需的，因为以交互方式登录到主机将授予对该主机凭据的控制权限。
>
> 有关登录类型、常见管理工具和凭据公开的详细信息，请参阅[管理工具和登录类型](http://aka.ms/admintoolsecurity)。

##### <a name="use-of-approved-support-technology-and-methods"></a>使用已批准的支持技术和方法

支持远程系统和用户的管理员必须遵循这些准则，以防止控制远程计算机的攻击者窃取其管理凭据。

- 如果可用，则应使用主要支持选项。
- 如果主要支持选项不可用，则只应使用次要支持选项。
- 禁止的支持方法可能永远不会使用。
- 在任何时候，任何管理帐户可能都不会执行 Internet 浏览或电子邮件访问。

###### <a name="tier-0-forest-domain-and-dc-administration"></a>第 0 层林、域和 DC 管理

确保将以下做法应用于此情形：

- **远程服务器支持** - 远程访问服务器时，第 0 层管理员必须遵守以下原则：
  - **主要（工具）** - 使用网络登录的远程工具（类型 3）。 有关详细信息，请参阅[管理工具和登录类型](http://aka.ms/admintoolsecurity)。
  - **主要（交互式）** - 通过域帐户从管理工作站使用 RDP RestrictedAdmin 或标准 RDP 会话

    > [!NOTE]
    > 如果你有第 0 层权限管理解决方案，则添加“使用从特权访问管理解决方案实时获取的权限”。

- **物理服务器支持** - 当以物理方式出现在服务器控制台或虚拟机控制台（Hyper-V 或 VMWare 工具）上时，这些帐户没有任何特定的管理工具使用限制，仅受制于标准用户任务（如电子邮件和浏览开放 Internet）的一般限制。

   > [!NOTE]
   > 第 0 层管理不同于其他层的管理，因为第 0 层的所有资产已直接或间接控制所有资产。 例如，控制 DC 的攻击者无需窃取已登录管理员的凭据，因为他们已有权访问数据库中的所有域凭据。

###### <a name="tier-1-server-and-enterprise-application-support"></a>第 1 层服务器和企业应用程序支持

确保将以下做法应用于此情形：

- **远程服务器支持** - 远程访问服务器时，第 1 级管理员必须遵守以下原则：
   - **主要（工具）** - 使用网络登录的远程工具（类型 3）。 有关详细信息，请参阅[降低传递哈希和其他凭据被盗的风险](https://www.microsoft.com/pth) v1 (pp 42-47)。
   - **主要（交互式）** - 通过使用从特权访问管理解决方案实时获取的权限的域帐户从管理工作站使用 RDP RestrictedAdmin。
   - **次要** - 通过使用由 LAPS 从管理工作站设置的本地帐户密码登录到服务器。
   - **禁止** - 标准 RDP 可能不能用于域帐户。
   - **禁止** - 在会话中使用域帐户凭据（例如，使用 *RunAs* 或对共享进行身份验证）。 这会公开到被盗的风险的登录凭据。
- **物理服务器支持** - 当以物理方式出现在服务器控制台或虚拟机控制台（HYPER-V 或 VMWare 工具）上时，在访问服务器之前第 1 层管理员必须从 LAPS 检索本地帐户密码。
   - **主要** - 登录到服务器之前，从管理工作站检索由 LAPS 设置的本地帐户密码。
   - **禁止** - 在此情形中不允许使用域帐户登录。
   - **禁止** - 在会话中使用域帐户凭据（例如，RunAs 或对共享进行身份验证）。 这会公开到被盗的风险的登录凭据。

###### <a name="tier-2-help-desk-and-user-support"></a>第 2 层技术支持和用户支持

技术支持和用户支持组织为最终用户（不需要管理权限）和用户工作站（需要管理特权）执行支持。

**用户支持** - 任务包括协助用户执行不需要修改工作站的任务、经常向他们展示如何使用应用程序功能或操作系统功能。

- **桌边用户支持** - 第 2 层支持人员以物理方式位于用户工作区。
   - **主要** - 可以在没有工具的情况下提供“即时权限提升”支持。
   - **禁止** - 在此情形中不允许使用帐户管理凭据登录。 如果需要管理权限，请切换到桌边工作站支持。
- **远程用户支持** - 第 2 层支持人员以物理方式远程到用户。
   - **主要** - 可以使用远程协助、Skype for Business 或类似的用户屏幕共享功能。 有关详细信息，请参阅[什么是 Windows 远程协助？](https://windows.microsoft.com/en-us/windows/what-is-windows-remote-assistance)
   - **禁止** - 在此情形中不允许使用帐户管理凭据登录。 如果需要管理权限，请切换到工作站支持。
- **工作站支持** - 任务包括执行工作站维护或故障排除（需要访问系统以查看日志、安装软件、更新驱动程序等）。
   - **桌边工作站支持** - 第 2 层支持人员以物理方式位于用户工作站。
      - **主要** - 连接到用户工作站之前，从管理工作站检索由 LAPS 设置的本地帐户密码。
      - **禁止** - 在此情形中不允许使用帐户管理凭据登录。
   - **远程工作站支持** - 第 2 层支持人员以物理方式远程到工作站。
      - **主要** - 使用从特权访问管理解决方案实时获取权限的域帐户，从管理工作站使用 RDP RestrictedAdmin。
      - **次要** - 连接到用户工作站之前，从管理工作站检索由 LAPS 设置的本地帐户密码。
      - **禁止** - 将标准 RDP 用于域帐户。

###### <a name="no-browsing-the-public-internet-with-admin-accounts-or-from-admin-workstations"></a>请勿使用管理帐户或从管理工作站浏览开放 Internet

使用管理帐户登录时或登录到管理工作站时，管理人员不能浏览开放 Internet。 唯一的授权的例外是使用 web 浏览器来管理基于云的服务。

###### <a name="no-accessing-email-with-admin-accounts-or-from-admin-workstations"></a>请勿使用管理帐户或从管理工作站访问电子邮件

使用管理帐户登录时或登录到管理工作站时，管理人员不能访问电子邮件。

###### <a name="store-service-and-application-account-passwords-in-a-secure-location"></a>将服务和应用程序帐户密码存储在安全位置

针对控制密码访问权限的物理安全过程，应使用以下准则：

- 将服务帐户密码锁定在物理安全的位置。
- 确保只有在帐户的层类或以上层类中受信任的人员才可访问帐户密码。
- 将访问密码的人数限制到最低以确保责任。
- 确保所有密码访问均由无任何关系的一方（如未接受过 IT 管理培训的经理）记录、跟踪和监视。

##### <a name="strong-authentication"></a>强身份验证

使用以下做法来正确配置强身份验证。

###### <a name="enforce-smartcard-multi-factor-authentication-mfa-for-all-admin-accounts"></a>对所有管理帐户强制实施智能卡多重身份验证 (MFA)

不允许任何管理帐户使用密码进行身份验证。 唯一授权的例外是受适当过程保护的紧急访问帐户。

将所有管理帐户链接到智能卡并启用属性“**交互式登录需要智能卡**”。

应实施脚本来自动定期重置随机密码哈希值，方法是禁用并立即重新启用属性“**交互式登录需要智能卡**”。

除了紧急访问帐户外，对于人员使用的帐户，不允许有例外情况。

###### <a name="enforce-multi-factor-authentication-for-all-cloud-admin-accounts"></a>对所有云管理帐户强制实施多重身份验证

云服务中具有管理权限的所有帐户均必须使用多重身份验证，如 Microsoft Azure 和 Office 365。

##### <a name="rare-use-emergency-procedures"></a>极少使用紧急过程

操作做法必须支持以下标准：

- 确保可以快速解决中断。
- 确保可以根据需要完成极少数高权限任务。
- 确保使用安全过程来保护凭据和权限。
- 确保遵循适当的跟踪和批准流程。

###### <a name="correctly-follow-appropriate-processes-for-all-emergency-access-accounts"></a>对于所有紧急访问帐户，正确遵循相应过程

确保每个紧急访问帐户的跟踪表处于安全位置。

对于每个帐户，应遵循其密码跟踪表上记录的过程，包括每次使用后更改密码、完成操作后注销任何工作站或服务器。

所有要使用紧急访问帐户的情况均应事先由变更批准委员会批准或事后作为已批准紧急使用情况。

###### <a name="restrict-and-monitor-usage-of-emergency-access-accounts"></a>限制和监视紧急访问帐户的使用情况

对于所有要使用紧急访问帐户的情况：

- 只有授权的域管理员可以使用域管理员权限访问紧急访问帐户。
- 仅可在域控制器和其他第 0 层主机上使用紧急访问帐户。
- 此帐户仅可用于：
  - 执行故障排除和更正导致无法使用正确管理帐户的技术问题。
  - 执行极少数的任务，例如：
    - 架构管理
    - 需要企业管理员权限的全林性任务

      > [!NOTE]
      > 拓扑管理，包括 Active Directory 站点和子网管理委派以限制这些权限的使用。

- 在任何情况下使用任一此类帐户时，均应具有安全组领导的书面授权
- 每个紧急访问帐户的跟踪表上的过程要求在每次使用时都需更改密码。 安全团队成员应确保正确做到这一点。

###### <a name="temporarily-assign-enterprise-admin-and-schema-admin-membership"></a>临时分配企业管理员和架构管理员成员身份

应根据需要添加权限并在使用后删除。 只应在完成任务过程中向紧急帐户分配这些权限，且持续时间最长为 10 个小时。 任务完成后，变更批准委员会应收集这些权限的所有使用情况和使用时间。

## <a name="esae-administrative-forest-design-approach"></a>ESAE 管理林设计方法

本部分介绍一种基于增强安全管理环境 (ESAE) 参考体系结构（由 Microsoft 的网络安全专业服务团队部署）的方法来保护客户免受网络安全攻击。

专用管理林使组织可以在安全控制强于生产环境的环境中轻松地托管管理帐户、工作站和组。

这种体系结构启用了大量安全控件，这无法在单个林体系结构中轻松地进行配置，即使有一个林受特权访问工作站 (PAW) 管理。 此方法可以将生产环境中特权级别非常高的帐户设置为管理林中的标准非特权用户，从而进行更出色的技术强制管理。 此体系结构还可以利用信任关系的选择性身份验证功能，以便仅限于登录到经过授权的主机（或向其公开凭据）。 在生产林需要更高级别的保证且进行完整的重新生成时避免开销和复杂性的情况下，管理林可以提供一个提升生产环境保证级别的环境。

虽然此方法确实向 Active Directory 环境中添加了一个林，但由于设计是固定的，硬件/软件占用率较低且用户数量较少，因此大大降低了成本和复杂性。

> [!NOTE]
> 这种方法非常适用于管理 Active Directory，但许多应用程序并不适合由使用标准信任的外部林中的帐户进行管理。

下图显示了一个 ESAE 林（用于管理第 0 层资产）和 PRIV 林（配置为与 Microsoft 标识管理器的特权访问管理功能结合使用）。 有关部署 MIM PAM 实例的详细信息，请参阅 [Active Directory 域服务 (AD DS) 的特权标识管理](https://technet.microsoft.com/library/mt150258.aspx)文章。

![ESAE 林（用于管理第 0 层资产）和 PRIV 林（配置为与 Microsoft Identity Manager 的 Privileged Access Management 功能结合使用）图](../media/securing-privileged-access-reference-material/PAW_RM_Fig14.JPG)

专用管理林是标准的单一域 Active Directory 林，专用于进行 Active Directory 管理。 由于用例有限，管理林和域可能会得到比生产林更进一步的强化。

管理林设计应包括以下注意事项：

- **作用域有限** - 管理林的主要价值是高级别的安全保障和缩小的攻击面，从而降低剩余风险。 可以使用林容纳其他管理功能和应用程序，但每增大一次作用域，都将增大林及其资源的攻击面。 由于目标是为了从内部限制林和管理员用户的功能以使受攻击面最小，因此每次增大作用域时，都应慎重考虑。
- **信任配置** - 在受管理的林或域与管理林之间配置信任
   - 生产环境到管理林之间需要单向信任。 这可以是域信任，也可以是林信任。 管理林/域不需要信任管理的域/林来管理 Active Directory，尽管其他应用程序可能需要双向信任关系、安全验证以及测试。
   - 应使用选择性身份验证对管理林中的帐户进行限制使其仅能够登录到适当的生产主机。 对于在 Active Directory 中维护域控制器和委派权限的权限，这通常需要将域控制器的“允许登录”权限授予给管理林中指定的第 0 层管理帐户。 有关详细信息，请参阅“配置选择性身份验证设置”。
- **权限和域强化** - 应根据 Active Directory 管理的要求，对管理林配置最低权限。
   - 在授予权限来管理域控制器和委派权限时，需要将管理林帐户添加到 BUILTIN\Administrators 域本地组。 这是因为域管理员全局组不能包含来自外部域的成员。
   - 使用此组来授予权限的一个注意点是，默认情况下，它们对新的组策略对象不具有管理访问权限。 根据“[此知识库文章](https://support.microsoft.com/kb/321476)”中的过程来更改架构默认权限可以实现此更改。
   - 管理林中用于管理生产环境的帐户不应被授予对管理林、其中的域或工作站的管理权限。
   - 高于管理林的管理权限应由离线进程进行严格控制，以降低攻击者或恶意内部人员清除审核日志的可能性。 这还有助于确保具有生产管理员帐户的人员无法放宽对其帐户的限制，从而避免增大组织的风险。
   - 管理林应遵循的域，包括强身份验证协议配置的 Microsoft 安全符合性基线 (SCB) 配置。
   - 所有管理林主机均应使用安全更新自动更新。 虽然这可能产生中断域控制器维护操作的风险，但它仍极大地缓解了未安装修补程序的漏洞带来的安全风险。

      > [!NOTE]
      > 专用 Windows Server 更新服务实例可以配置为自动批准更新。 有关详细信息，请参阅“批准更新”中的“自动批准更新的安装”部分。

- **工作站强化** - 使用“[特权访问工作站](../securing-privileged-access/privileged-access-workstations.md)”构建管理工作站（通过第 3 阶段），但域成员身份将更改为管理林（而不是生产环境）。
- **服务器和 DC 强化** - 对于管理林中的所有域控制器和服务器：
   - 确保已使用[安装介质的清洁源](http://aka.ms/cleansource)中的指南验证所有介质
   - 确保管理林服务器已安装最新的操作系统，即使这在生产中并不可行。
   - 管理林主机应使用安全更新自动更新。

      > [!NOTE]
      > Windows Server 更新服务可以配置为自动批准更新。 有关详细信息，请参阅“批准更新”中的“自动批准更新的安装”部分。

   - “安全基线”应作为起始配置。

      > [!NOTE]
      > 在管理主机上配置基线，客户可以使用 Microsoft 安全合规性工具集 (SCT)。

   - “安全引导”可防止攻击者或恶意软件试图将未经签名的代码加载到引导过程中。

      > [!NOTE]
      > Windows 8 中已引用了此功能以便利用统一可扩展固件接口 (UEFI)。

   - “全卷加密”可防止计算机实体丢失（如远程使用的管理笔记本电脑）。

      > [!NOTE]
      > 有关详细信息，请参阅 [BitLocker](https://technet.microsoft.com/library/dn641993.aspx)。

   - “USB 限制”可提供针对物理感染媒介的保护。

      > [!NOTE]
      > 有关详细信息，请参阅[控制可移动设备和介质的读取或写入权限](https://technet.microsoft.com/library/cc730808(v=ws.10).aspx)。

   - “网络隔离”可防止网络攻击和管理员的无意操作。 主机防火墙应阻止除明确需要的连接以外的所有传入连接，并阻止所有出站 Internet 访问。

   - 反恶意软件可抵御已知的威胁和恶意软件。

   - 攻击面分析可防止在安装新软件的过程中将新的攻击媒介引入 Windows。

      > [!NOTE]
      > 使用 [Attack Surface Analyzer (ASA)](https://www.microsoft.com/en-us/download/details.aspx?id=24487) 等工具，将有助于评估主机上的配置设置，并标识由软件或配置更改引入的攻击媒介。

- 帐户强化
   - 应对管理林中的所有帐户配置多重身份验证，但有一个帐户除外。 至少有一个管理帐户应是基于密码的，以确保能够在多重身份验证过程中断时进行正常访问。 此帐户应受到严格的物理控制过程保护。
   - 配置有多重身份验证的帐户应配置为定期在帐户上设置新的 NTLM 哈希。 这可以通过禁用和启用帐户属性“交互式登录需要智能卡”来实现。

      > [!NOTE]
      > 这可能会中断正在使用此帐户的操作，因此只有当管理员不使用该帐户时（如夜间或周末），才可以启动此过程。

- 检测控制
   - 应设计管理林的检测控制，以便在管理林中出现异常情况时发出警报。 数量有限的授权方案和活动可以帮助优化这些控制，使其比生产环境更加准确。

有关使用 Microsoft 服务为你的环境设计和部署 ESAE 的详细信息，请参阅 [本页](https://www.microsoft.com/services)。

## <a name="tier-0-equivalency"></a>第 0 层等效性

大多数组织都会对功能强大的第 0 层 Active Directory 组的成员身份进行控制，如管理员、域管理员和企业管理员。  在典型的 Active Directory 环境中，许多组织都会忽视具有同等有效权限的其他组可能带来的风险。 这些组为攻击者能够使用各种不同的攻击方法相同的显式第 0 层权限提供的相对简单的升级路径。

例如，服务器操作员可以获取域控制器备份介质的访问权限并从此介质的文件中提取所有凭据，然后使用这些凭据提升权限。

组织应该控制和监视所有第 0 层组中的成员身份（包括嵌套成员身份），包括：

- Enterprise Admins
- Domain Admins
- 架构管理员
- BUILTIN\Administrators
- Account Operators
- Backup Operators
- 打印操作员
- Server Operators
- 域控制器
- 只读域控制器
- Group Policy Creator Owners
- Cryptographic Operators
- Distributed COM Users
- 其他委派组中的可能由你的组织来管理目录操作还可能具有有效第 0 层访问权限创建的自定义组。

## <a name="administrative-tools-and-logon-types"></a>管理工具和登录类型

此引用信息可帮助识别与使用不同管理工具进行远程管理相关的凭据公开风险。

在远程管理情形中，凭据始终在源计算机上公开，因此对于敏感或高影响帐户，建议使用可信赖的特许访问工作站 (PAW)。 凭据是否会公开给目标（远程）计算机上的潜在盗窃者，主要取决于连接方法所使用的 Windows 登录类型。

此表包含有关最常用管理工具和连接方法的指南：

|连接方法|登录类型|目标上可重复使用的凭据|备注|
|-----------|-------|--------------------|------|
|在控制台上登录|Interactive (交互)|v|包括硬件远程访问/无人照看卡和网络 KVM。|
|RUNAS|Interactive (交互)|v||
|RUNAS/网络|NewCredentials|v|克隆当前 LSA 会话进行本地访问，但连接到网络资源时使用新的凭据。|
|远程桌面（成功）|RemoteInteractive|v|如果远程桌面客户端配置为共享本地设备和资源，这些可能也会受到影响。|
|远程桌面（失败 - 登录类型被拒绝）|RemoteInteractive|-|默认情况下，如果 RDP 登录失败，凭据只会存储很短的时间。 如果计算机受到破坏，则可能并非如此。|
|Net use * \\\SERVER|网络|-||
|Net use * \\\SERVER /u:user|网络|-||
|MMC 管理单元到远程计算机|网络|-|例如：计算机管理、 事件查看器中，设备管理器服务|
|PowerShell WinRM|网络|-|例如：Enter-pssession 服务器|
|PowerShell WinRM（具有 CredSSP）|NetworkClearText|v|New-PSSession 服务器<br />-Authentication Credssp<br />-Credential cred|
|PsExec 而无需显式凭据|网络|-|例如：PsExec \\\server cmd|
|PsExec（有显式凭据）|网络 + 交互|v|PsExec \\\server -u user -p pwd cmd<br />创建多个登录会话。|
|远程注册表|网络|-||
|远程桌面网关|网络|-|对远程桌面网关进行身份验证。|
|计划任务|Batch|v|密码也将在磁盘上被另存为 LSA 机密。|
|将工具作为服务运行|服务|v|密码也将在磁盘上被另存为 LSA 机密。|
|漏洞扫描程序|网络|-|大多数扫描程序默认使用网络登录，但某些供应商可能会实施非网络登录并引入多个凭据被盗风险。|

对于 Web 身份验证，请使用下表中的引用：

|连接方法|登录类型|目标上可重复使用的凭据|备注|
|-----------|-------|--------------------|------|
|IIS“基本身份验证”|NetworkCleartext<br />(IIS 6.0+)<br /><br />Interactive (交互)<br />（低于 IIS 6.0）|v||
|IIS“集成 Windows 身份验证”|网络|-|NTLM 和 Kerberos 提供程序。|

列定义：

- **登录类型**可标识连接启动的登录类型。
- **目标上可重复使用的凭据**指示以下凭据将存储在目标计算机（指定帐户在本地登录）的 LSASS 进程内存中：
   - LM 和 NT 哈希
   - Kerberos TGT
   - 纯文本密码（如果适用）。

按以下方式定义此表中的符号：

- (-) 表示凭据未公开。
- (v) 表示凭据已公开。

对于未出现在此表中的管理应用程序，可以从审核登录事件的登录类型字段中确定登录类型。 有关详细信息，请参阅[审核登录事件](https://technet.microsoft.com/library/cc787567(v=ws.10).aspx)。

在基于 Windows 的计算机中，以多个登录类型之一处理所有身份验证，无论使用何种身份验证协议或身份验证程序。 此表包含最常见的登录类型以及相对于凭据被盗的属性：

|登录类型|#|接受的身份验证程序|LSA 会话中可重复使用的凭据|示例|
|-------|---|--------------|--------------------|------|
|交互（也称为本地登录）|2|密码、智能卡、<br />其他|是|控制台登录；<br />RUNAS；<br />硬件远程控制解决方案（如网络 KVM 或远程访问/服务器中的无人照看卡）<br />IIS 基本身份验证（低于 IIS 6.0）|
|网络|3|密码，<br />NT 哈希、<br />Kerberos 票证|否（例外情况，如果已启用委派，则 Kerberos 票证存在）|NET USE；<br />RPC 调用；<br />远程注册表；<br />IIS 集成 Windows 身份验证；<br />SQL Windows 身份验证；|
|Batch|4|密码（通常存储为 LSA 机密）|是|计划任务|
|服务|5|密码（通常存储为 LSA 机密）|是|Windows 服务|
|NetworkCleartext|8|密码|是|IIS 基本身份验证（IIS 6.0 和更高版本）；<br />Windows PowerShell（具有 CredSSP）|
|NewCredentials|9|密码|是|RUNAS/网络|
|RemoteInteractive|10|密码、智能卡、<br />其他|是|远程桌面（以前称为“终端服务”）|

列定义：

- **登录类型**是请求的登录类型。
- **#** 是安全事件日志中的审核事件中报告的登录类型的数值标识符。
- **接受的身份验证程序**指示哪些类型的身份验证程序能够启动此类型登录。
- LSA 会话中的**可重复使用的凭据**指示登录类型是否会导致 LSA 会话保存凭据，如可用于对其他网络资源进行身份验证的纯文本密码、NT 哈希或 Kerberos 票证。
- **示例**列出登录类型使用的常见情形。

> [!NOTE]
> 有关登录类型的详细信息，请参阅 [SECURITY_LOGON_TYPE 枚举](https://technet.microsoft.com/library/aa380129(VS.85).aspx)。
